# 中文自然语言时间解析器 (CN2T)

灵活、轻（存疑）量级的中文自然语言时间解析器。  
能够将各种中文时间表达式转换为时间范围。  
通过自定义 lexicon 和 template，可以实现更复杂的语法解析，~~当然也可以用来解析别的语言（确信）~~

理论上，对于中文来说，准确度能够远超[dateparser](https://github.com/scrapinghub/dateparser)。

> **整个项目不依赖任何大模型实现功能**
> ~~其实就是高级点的查表（超小声）~~不信你看那两个词库都多大了！（怒）

## 适用范围

- 支持几乎所有常见的时间格式，不支持的是因为 lexicon 还在继续写，在写了在写了.jpg
- 仅支持阳历（格里高利历）
- 暂不支持~~农历、~~阴历（囍报：支持农历啦！）
- 目前还不能解析嵌入句子中的时间，这点和[cn2an](https://github.com/Ailln/cn2an)不同（嗯都是 NLP 这么比较也没啥问题（确信）

## 依赖项

```cmd
:: 必选
pip install cn2an cutword pyyaml python-dateutil

:: 可选
pip install lunarcalendar dateparser jionlp
```

- [cn2an](https://github.com/Ailln/cn2an)：用于中文数字处理
- [cutword](https://github.com/liwenju0/cutword)：用于分词（感觉比 jieba 好用点，但是自定义词典只能从文件加载，想交 pr 了）
- [pyyaml](https://github.com/yaml/pyyaml)：用于解析 yaml；说实话我真的很想把 yaml 编译成 bson 的，但是目前还不完备，所以作罢
- [dateutil](https://github.com/dateutil/dateutil)：用于提供 relativedelta，这玩意太好用了你们知道吗.jpg
- [LunarCalendar](https://github.com/wolfhong/LunarCalendar)：用于农历转换（虽然说已经7年没更新了，但是*尚挺能饭*）

以及两个用来对比的：

- [JioNLP](https://github.com/dongrixinyu/JioNLP)：对比测试用；速度比 cn2t 快 0~1 倍，极小部分词条准确度欠佳
- [dateparser](https://github.com/scrapinghub/dateparser)：对比测试用；对于中文来说慢的一批（仅有 JioNLP 20%~50% 速度），而且准确性和普适性也不太行（）

## 快速开始

```python
from main import full_parse
# from main是因为这玩意是个模块不是个包……
# 虽然说我明明可以给它起个别的名字的但我就是叫main怎么你了（不是

result = full_parse("2025年8月15日下午3点半")
if result:
    start_time, end_time = result
    print(f"开始时间: {start_time.strftime('%Y-%m-%d %H:%M:%S')}")
    print(f"结束时间: {end_time.strftime('%Y-%m-%d %H:%M:%S')}")
else: # 失败会返回None
    print("解析失败")
```

## 解析流程

整体分为七步，**可以拆开用**：

1. `cutword` - 分词  
   分词的时候把 lexicon 的所有词头传进去了，这样能尽量保证分出来的东西准确一点。
2. `run_merge_num` - 合并数字  
   这一步是把数字合并起来，因为分词的时候数字经常会被分，这个没法避免（总不能数字打个大表吧！）
3. `add_tag` - 打标  
   打的东西不止有标签，查表也在这步完成了。
4. `first_parser` - 一步解析  
   实际的解析从这开始。叫一步解析是因为我有个思路文档（没传上来）里面把这个定为第一步。  
   这一步解析主要的作用是构建 Struct 结构。
5. `second_parser` - 二步解析  
   这一步解析主要的作用是填充 Struct，通过查表和模板（就是那两个 yaml）来把形式化的结构转换成具有实际内容的结构。
6. `third_parser` - 三步解析  
   这一步解析主要的作用是应用基准值、偏移量等需要数学计算的东西。
7. `to_datetime` - 解析为 datetime  
   最后把结构转换成更常用的 datetime。  
   当然如果可以的话，我还是建议直接和三步解析生成的结构交互，把`instant_merge`设为 True 之后直接生成的结构相比 datetime 能有更多更丰富的信息。

（题外话：`full_parse`的实现其实是这样的——

```python
to_datetime(*third_parser(second_parser(first_parser(add_tag(run_merge_num(cutter.cutword(text)))))))
```

括 号 叠 叠 乐）

## 欢迎 PR

来点 lexicon 吧球球惹！  
多交 PR 喵，多交 PR 谢谢喵！  
喵喵喵喵喵喵喵！🐱

## 附录：`compare_test.py`中测试样例的运行结果

```log
运行硬件: i7-13700KF CPU, 64GB 5200MHz RAM
测试时间: 2025-08-20 04:52:30.306716
================================================
2025年8月15日
cn2t:               156.3μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
jionlp:             149.6μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
dateparser:         382.0μs      2025-08-15 00:00:00

================================================
贰零贰伍年捌月拾伍日
cn2t:               192.5μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
jionlp:              84.1μs      <解析失败>  
dateparser:          50.8μs      <解析失败>

================================================
二〇二五年八月十五日
cn2t:               213.3μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
jionlp:             133.6μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
dateparser:          49.3μs      <解析失败>

================================================
2025/08/15
cn2t:               137.9μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
jionlp:             120.5μs      2025-08-15 00:00:00 ~ 2025-08-15 23:59:59
dateparser:         325.2μs      2025-08-15 00:00:00

================================================
2025年8月16日 14:30:45
cn2t:               256.0μs      2025-08-16 14:30:45 ~ 2025-08-16 14:30:45
jionlp:             222.5μs      2025-08-16 14:30:45 ~ 2025-08-16 14:30:45
dateparser:         488.4μs      2025-08-16 14:30:45

================================================
2025-08-16 18:15:00
cn2t:               240.9μs      2025-08-16 18:15:00 ~ 2025-08-16 18:15:00
jionlp:             204.3μs      2025-08-16 18:15:00 ~ 2025-08-16 18:15:00
dateparser:         488.3μs      2025-08-16 18:15:00

================================================
2025/08/16 23:59:59
cn2t:               247.6μs      2025-08-16 23:59:59 ~ 2025-08-16 23:59:59
jionlp:             196.9μs      2025-08-16 23:59:59 ~ 2025-08-16 23:59:59
dateparser:         454.5μs      2025-08-16 23:59:59

================================================
二〇二五年八月十六日 下午三点半
cn2t:               309.5μs      2025-08-16 15:30:00 ~ 2025-08-16 15:30:59
jionlp:             209.1μs      2025-08-16 15:30:00 ~ 2025-08-16 15:30:59
dateparser:          64.1μs      <解析失败>

================================================
二零二五年八月十六号 中午12点整
cn2t:               310.8μs      2025-08-16 12:00:00 ~ 2025-08-16 12:00:59
jionlp:             211.3μs      2025-08-16 12:00:00 ~ 2025-08-16 12:59:59
dateparser:          80.1μs      <解析失败>

================================================
二五年8月16日 午夜12点
cn2t:               279.8μs      2025-08-17 00:00:00 ~ 2025-08-17 00:59:59
jionlp:             195.6μs      2025-08-17 00:00:00 ~ 2025-08-17 00:59:59
dateparser:          68.9μs      <解析失败>

================================================
2025年8月16日 上午9时15分
cn2t:               234.2μs      2025-08-16 09:15:00 ~ 2025-08-16 09:15:59
jionlp:             233.3μs      2025-08-16 09:15:00 ~ 2025-08-16 09:15:59
dateparser:         102.8μs      <解析失败>

================================================
2025-08-16 下午11:08
cn2t:               239.2μs      2025-08-16 23:08:00 ~ 2025-08-16 23:08:59
jionlp:             198.9μs      2025-08-16 23:08:00 ~ 2025-08-16 23:08:59
dateparser:         515.7μs      2025-08-16 23:08:00

================================================
8月16日 凌晨3:20
cn2t:               196.6μs      2025-08-16 03:20:00 ~ 2025-08-16 03:20:59
jionlp:             152.0μs      2025-08-16 03:20:00 ~ 2025-08-16 03:20:59
dateparser:         533.5μs      <解析失败>

================================================
8月16日 14:00
cn2t:               191.2μs      2025-08-16 14:00:00 ~ 2025-08-16 14:00:59
jionlp:             145.3μs      2025-08-16 14:00:00 ~ 2025-08-16 14:00:59
dateparser:         484.2μs      <解析失败>

================================================
十二月三十一日 18:00
cn2t:               221.7μs      2025-12-31 18:00:00 ~ 2025-12-31 18:00:59
jionlp:             160.4μs      2025-12-31 18:00:00 ~ 2025-12-31 18:00:59
dateparser:          64.8μs      <解析失败>

================================================
02月15日 09:30:00
cn2t:               224.0μs      2025-02-15 09:30:00 ~ 2025-02-15 09:30:00
jionlp:             180.7μs      2025-02-15 09:30:00 ~ 2025-02-15 09:30:00
dateparser:         532.3μs      <解析失败>

================================================
16号晚上8点
cn2t:               112.5μs      2025-08-16 20:00:00 ~ 2025-08-16 20:59:59
jionlp:             118.3μs      2025-08-16 20:00:00 ~ 2025-08-16 20:59:59
dateparser:          53.5μs      <解析失败>

================================================
01日 15:30
cn2t:               132.4μs      2025-08-01 15:30:00 ~ 2025-08-01 15:30:59
jionlp:             129.3μs      2025-08-01 15:30:00 ~ 2025-08-01 15:30:59
dateparser:         263.0μs      2025-08-19 15:30:00

================================================
31日下午4点半
cn2t:               144.8μs      2025-08-31 16:30:00 ~ 2025-08-31 16:30:59
jionlp:             124.9μs      2025-08-31 16:30:00 ~ 2025-08-31 16:30:59
dateparser:          57.5μs      <解析失败>

================================================
下午4点
cn2t:                73.0μs      2025-08-20 16:00:00 ~ 2025-08-20 16:59:59
jionlp:              76.1μs      2025-08-20 16:00:00 ~ 2025-08-20 16:59:59
dateparser:          40.6μs      <解析失败>

================================================
上午10:15
cn2t:                95.5μs      2025-08-20 10:15:00 ~ 2025-08-20 10:15:59
jionlp:              95.9μs      2025-08-20 10:15:00 ~ 2025-08-20 10:15:59
dateparser:         536.7μs      2025-08-19 10:15:00

================================================
23:45:30
cn2t:               122.9μs      2025-08-20 23:45:30 ~ 2025-08-20 23:45:30
jionlp:             102.0μs      2025-08-20 23:45:30 ~ 2025-08-20 23:45:30
dateparser:         480.9μs      2025-08-19 23:45:30

================================================
今天
cn2t:                55.4μs      2025-08-20 00:00:00 ~ 2025-08-20 23:59:59
jionlp:              46.1μs      2025-08-20 00:00:00 ~ 2025-08-20 23:59:59
dateparser:         210.8μs      2025-08-20 04:52:44.487550

================================================
明天凌晨
cn2t:                91.9μs      2025-08-21 00:00:00 ~ 2025-08-21 04:59:59
jionlp:              70.3μs      2025-08-21 00:00:00 ~ 2025-08-21 04:59:59
dateparser:          35.7μs      <解析失败>

================================================
昨天中午
cn2t:               105.0μs      2025-08-19 12:00:00 ~ 2025-08-19 12:59:59
jionlp:              70.5μs      2025-08-19 12:00:00 ~ 2025-08-19 13:59:59
dateparser:         240.2μs      2025-08-19 12:00:00

================================================
三天后
cn2t:               109.7μs      2025-08-23 00:00:00 ~ 2025-08-23 23:59:59
jionlp:              94.2μs      2025-08-23 00:00:00 ~ 2025-08-23 23:59:59
dateparser:          34.7μs      <解析失败>

================================================
两周前
cn2t:               115.0μs      2025-08-06 00:00:00 ~ 2025-08-06 23:59:59
jionlp:             109.4μs      2025-08-04 00:00:00 ~ 2025-08-10 23:59:59
dateparser:          33.6μs      <解析失败>

================================================
下个月5号
cn2t:               145.0μs      2025-09-05 00:00:00 ~ 2025-09-05 23:59:59
jionlp:              84.7μs      2025-09-05 00:00:00 ~ 2025-09-05 23:59:59
dateparser:          43.2μs      <解析失败>

================================================
下周二
cn2t:                98.1μs      2025-08-26 00:00:00 ~ 2025-08-26 23:59:59
jionlp:              60.0μs      2025-08-26 00:00:00 ~ 2025-08-26 23:59:59
dateparser:          33.6μs      <解析失败>

================================================
上周三上午10点
cn2t:               150.9μs      2025-08-13 10:00:00 ~ 2025-08-13 10:59:59
jionlp:             117.3μs      2025-08-13 10:00:00 ~ 2025-08-13 10:59:59
dateparser:          51.0μs      <解析失败>

================================================
公历2025年8月16日
cn2t:               154.9μs      2025-08-16 00:00:00 ~ 2025-08-16 23:59:59
jionlp:             159.6μs      2025-08-16 00:00:00 ~ 2025-08-16 23:59:59
dateparser:          82.3μs      <解析失败>

================================================
2025年8月
cn2t:                93.8μs      2025-08-01 00:00:00 ~ 2025-08-31 23:59:59
jionlp:             120.2μs      2025-08-01 00:00:00 ~ 2025-08-31 23:59:59
dateparser:         483.6μs      2025-08-19 00:00:00

================================================
8月
cn2t:                56.2μs      2025-08-01 00:00:00 ~ 2025-08-31 23:59:59
jionlp:              59.7μs      2025-08-01 00:00:00 ~ 2025-08-31 23:59:59
dateparser:         296.5μs      2025-08-19 00:00:00

================================================
2025/8/16 PM 3:45
cn2t:               220.4μs      2025-08-16 15:45:00 ~ 2025-08-16 15:45:59
jionlp:             155.4μs      <解析失败>  
dateparser:         429.0μs      <解析失败>

================================================
0001年1月1日
cn2t:               146.1μs      0001-01-01 00:00:00 ~ 0001-01-01 00:00:00
jionlp:             140.0μs      0001-01-01 00:00:00 ~ 0001-01-01 23:59:59
dateparser:         370.8μs      0001-01-01 00:00:00

================================================
9999年12月31日 23:59:59
cn2t:               264.0μs      9999-12-31 23:59:59 ~ 9999-12-31 23:59:59
jionlp:             232.0μs      0999-12-31 23:59:59 ~ 0999-12-31 23:59:59
dateparser:         493.1μs      9999-12-31 23:59:59

================================================
2024年2月29日
cn2t:               149.7μs      2024-02-29 00:00:00 ~ 2024-02-29 23:59:59
jionlp:             152.2μs      2024-02-29 00:00:00 ~ 2024-02-29 23:59:59
dateparser:         393.9μs      2024-02-29 00:00:00

================================================
2025年13月1日
cn2t:               132.7μs      <无效时间>
jionlp:             135.5μs      2025-01-01 00:00:00 ~ 2025-12-31 23:59:59
dateparser:         382.6μs      2025-01-13 00:00:00

================================================
2025年2月30日
cn2t:               133.1μs      <无效时间>
jionlp:             315.0μs      <解析失败>  
dateparser:         372.9μs      <解析失败>

================================================
昨天25点
cn2t:                83.7μs      <无效时间>
jionlp:              92.6μs      2025-08-19 05:00:00 ~ 2025-08-19 05:59:59
dateparser:          44.2μs      <解析失败>

================================================
2025年农历八月十六
cn2t:               225.4μs      2025-10-07 00:00:00 ~ 2025-10-07 23:59:59
jionlp:             163.2μs      2025-09-22 00:00:00 ~ 2025-10-20 23:59:59
dateparser:          74.6μs      <解析失败>

================================================
无效时间格式
cn2t:                15.1μs      <解析失败>
jionlp:              60.3μs      <解析失败>  
dateparser:          37.5μs      <解析失败>

================================================
2025年8月32日
cn2t:               125.1μs      <无效时间>
jionlp:             146.1μs      2025-08-01 00:00:00 ~ 2025-08-31 23:59:59
dateparser:         349.5μs      <解析失败>

================================================
嘉靖十五年
cn2t:                82.4μs      1536-01-01 00:00:00 ~ 1536-12-31 23:59:59
jionlp:              58.5μs      <解析失败>  
dateparser:          36.6μs      <解析失败>

================================================
2023年10月1日
cn2t:               145.7μs      2023-10-01 00:00:00 ~ 2023-10-01 23:59:59
jionlp:             153.6μs      2023-10-01 00:00:00 ~ 2023-10-01 23:59:59
dateparser:         386.0μs      2023-10-01 00:00:00

================================================
2024-05-20
cn2t:               138.7μs      2024-05-20 00:00:00 ~ 2024-05-20 23:59:59
jionlp:             132.3μs      2024-05-20 00:00:00 ~ 2024-05-20 23:59:59
dateparser:         362.9μs      2024-05-20 00:00:00

================================================
2025年元旦
cn2t:               131.3μs      2025-01-01 00:00:00 ~ 2025-01-01 23:59:59
jionlp:             107.1μs      2025-01-01 00:00:00 ~ 2025-01-01 23:59:59
dateparser:          68.1μs      <解析失败>

================================================
2022/12/31 18:30
cn2t:               199.0μs      2022-12-31 18:30:00 ~ 2022-12-31 18:30:59
jionlp:             176.7μs      2022-12-31 18:30:00 ~ 2022-12-31 18:30:59
dateparser:         401.5μs      2022-12-31 18:30:00

================================================
2026年农历正月初一
cn2t:               184.5μs      2026-02-17 00:00:00 ~ 2026-02-17 23:59:59
jionlp:             151.4μs      2026-02-17 00:00:00 ~ 2026-02-17 23:59:59
dateparser:          75.8μs      <解析失败>

================================================
今天
cn2t:                56.0μs      2025-08-20 00:00:00 ~ 2025-08-20 23:59:59
jionlp:              47.2μs      2025-08-20 00:00:00 ~ 2025-08-20 23:59:59
dateparser:         223.6μs      2025-08-20 04:52:57.306026

================================================
明天下午3点
cn2t:               105.7μs      2025-08-21 15:00:00 ~ 2025-08-21 15:59:59
jionlp:              97.8μs      2025-08-21 15:00:00 ~ 2025-08-21 15:59:59
dateparser:          46.8μs      <解析失败>

================================================
大后天晚上
cn2t:                91.9μs      2025-08-23 17:00:00 ~ 2025-08-23 22:59:59
jionlp:              81.6μs      2025-08-23 18:00:00 ~ 2025-08-23 23:59:59
dateparser:          39.4μs      <解析失败>

================================================
昨天上午9点
cn2t:               104.9μs      2025-08-19 09:00:00 ~ 2025-08-19 09:59:59
jionlp:              98.2μs      2025-08-19 09:00:00 ~ 2025-08-19 09:59:59
dateparser:          47.1μs      <解析失败>

================================================
上周三
cn2t:                98.8μs      2025-08-13 00:00:00 ~ 2025-08-13 23:59:59
jionlp:              60.7μs      2025-08-13 00:00:00 ~ 2025-08-13 23:59:59
dateparser:          32.3μs      <解析失败>

================================================
下个月5号
cn2t:               143.7μs      2025-09-05 00:00:00 ~ 2025-09-05 23:59:59
jionlp:              85.3μs      2025-09-05 00:00:00 ~ 2025-09-05 23:59:59
dateparser:          42.7μs      <解析失败>

================================================
明年春节
cn2t:               166.0μs      2026-02-17 00:00:00 ~ 2026-02-17 23:59:59
jionlp:              77.9μs      2026-02-17 00:00:00 ~ 2026-02-17 23:59:59
dateparser:          35.5μs      <解析失败>

================================================
3天后
cn2t:                95.5μs      2025-08-23 00:00:00 ~ 2025-08-23 23:59:59
jionlp:              94.4μs      2025-08-23 00:00:00 ~ 2025-08-23 23:59:59
dateparser:         197.8μs      2025-08-23 04:52:59.188890

================================================
两周前
cn2t:               109.3μs      2025-08-06 00:00:00 ~ 2025-08-06 23:59:59
jionlp:             109.1μs      2025-08-04 00:00:00 ~ 2025-08-10 23:59:59
dateparser:          33.2μs      <解析失败>

================================================
1小时30分钟后
cn2t:               163.4μs      2025-08-20 06:22:00 ~ 2025-08-20 06:22:59
jionlp:             185.1μs      2025-08-20 05:22:59 ~ 2025-08-20 05:23:59
dateparser:         541.8μs      2025-08-20 06:22:59.991504
```

多交 PR 喵，多交 PR 谢谢喵！
