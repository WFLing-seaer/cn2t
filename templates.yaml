STANDARD_YMD:
  WHEN:
    - STRUCT:
        BODY:
          VAL: [-9999, 9999]
          DESC: SEP
    - STRUCT:
        BODY:
          VAL: [1, 12]
          DESC: SEP
    - STRUCT:
        BODY:
          VAL: [1, 31]
  THEN:
    - STRUCT: #此处三个STRUCT与上面一一对应
        META:
          ID: YR
          STEP:
            PERC: YR
            AMP: 1
    - STRUCT:
        META:
          ID: MO
          STEP:
            PERC: MO
            AMP: 1
    - STRUCT:
        META:
          ID: DA
          STEP:
            PERC: DA
            AMP: 1

STANDARD_HMS:
  WHEN:
    - STRUCT:
        BODY:
          VAL: [0, 23]
          DESC: HR_OR_MI
        META: N/A
    - STRUCT:
        BODY:
          VAL: [0, 59]
          DESC: HR_OR_MI
        META: N/A
    - STRUCT:
        BODY:
          VAL: [0, 59]
        META: N/A
  THEN:
    - STRUCT:
        META:
          ID: HR
          STEP:
            PERC: HR
            AMP: 1
    - STRUCT:
        META:
          ID: MI
          STEP:
            PERC: MI
            AMP: 1
    - STRUCT:
        META:
          ID: SC
          STEP:
            PERC: SC
            AMP: 1

HM_AFTER_DATE:
  WHEN:
    - STRUCT:
        META:
          ID: DA
          STEP:
            PERC: DA
            AMP: 1
    - STRUCT:
        BODY:
          VAL: [0, 23]
          DESC: HR_OR_MI
        META: N/A
    - STRUCT:
        BODY:
          VAL: [0, 59]
        META: N/A
  THEN:
    - STRUCT: null
    - STRUCT:
        META:
          ID: HR
          STEP:
            PERC: HR
            AMP: 1
    - STRUCT:
        META:
          ID: MI
          STEP:
            PERC: MI
            AMP: 1

M_AFTER_H:
  WHEN:
    - STRUCT:
        BODY:
          DESC: HR_OR_MI
        META:
          ID: N/A
    - STRUCT:
        BODY:
          VAL: [0, 59]
        META:
          ID: N/A
  THEN:
    - STRUCT:
        META:
          ID: HR
          STEP:
            PERC: HR
            AMP: 1
    - STRUCT:
        META:
          ID: MI
          STEP:
            PERC: MI
            AMP: 1

M_AFTER_CERTAIN_H:
  WHEN:
    - STRUCT:
        META:
          ID: HR
    - STRUCT:
        BODY:
          VAL: [0, 59]
        META: N/A
  THEN:
    - STRUCT:
        META:
          ID: HR
          STEP:
            PERC: HR
            AMP: 1
    - STRUCT:
        META:
          ID: MI
          STEP:
            PERC: MI
            AMP: 1

SHORT_YEAR:
  SITU:
    - FLAG_SMART_YEAR #可以通过这个FLAG控制启用/禁用哪些模板
  WHEN:
    - STRUCT:
        BODY:
          RAW: "len(raw) <= 3"
          VAL: [0, 99]
        META:
          ID: YR
        DATUM: N/A
  THEN:
    - STRUCT:
        META:
          CYCL:
            PERIOD: 100
            RANGE: [94, 5] #表示向前94年，向后5年
        BODY:
          MOD: "val+struct.meta.cycl.period*math.ceil((datum-struct.meta.cycl.range[0]-val)/struct.meta.cycl.period)"

MINUTE_AND_HALF:
  WHEN:
    - STRUCT:
        META:
          ID: MI
    - STRUCT:
        BODY:
          DESC: 半
  THEN:
    - STRUCT: null
    - STRUCT:
        BODY:
          VAL: 30
        META:
          ID: SC
          STEP:
            PERC: SC
            AMP: 1

HOUR_AND_HALF:
  WHEN:
    - STRUCT:
        META:
          ID: HR
    - STRUCT:
        BODY:
          DESC: 半
  THEN:
    - STRUCT: null
    - STRUCT:
        BODY:
          VAL: 30
        META:
          ID: MI
          STEP:
            PERC: MI
            AMP: 1

DAY_AND_HALF:
  WHEN:
    - STRUCT:
        META:
          ID: DA
    - STRUCT:
        BODY:
          DESC: 半
  THEN:
    - STRUCT: null
    - STRUCT:
        BODY:
          VAL: 12
        META:
          ID: HR
          STEP:
            PERC: HR
            AMP: 1

MONTH_AND_HALF:
  WHEN:
    - STRUCT:
        META:
          ID: MO
    - STRUCT:
        BODY:
          DESC: 半
  THEN:
    - STRUCT: null
    - STRUCT:
        BODY:
          VAL: 14
        META:
          ID: DA
          STEP:
            PERC: DA
            AMP: 2

YEAR_AND_HALF:
  WHEN:
    - STRUCT:
        META:
          ID: YR
    - STRUCT:
        BODY:
          DESC: 半
  THEN:
    - STRUCT: null
    - STRUCT:
        BODY:
          VAL: 6
        META:
          ID: MO
          STEP:
            PERC: MO
            AMP: 1

DAY_CHN_NUM_ONLY: # 比如八月十五这种，中文表达+不显式写出“日”→认为是农历
  WHEN:
    - STRUCT:
        META:
          ID: MO
    - STRUCT:
        BODY:
          VAL: [1, 30]
          RAW: "not any(c in '0123456789' for c in raw)"
          DESC: N/A
  THEN:
    - STRUCT:
        DATUM:
          lunar: true
    - STRUCT:
        META:
          ID: DA
          STEP:
            PERC: DA
            AMP: 1

BEFORE2: #x前和x后前面的字段要么一个要么两个，三个太少见了不作考虑，因此直接枚举就行
  WHEN:
    - STRUCT:
        DATUM:
          lunar: N/A #防止“春节后”被解析成“一个月零一天后”这种事
    - STRUCT:
        DATUM:
          lunar: N/A
        BODY:
          MOD: "'#before' and val"
  THEN:
    - STRUCT:
        BODY:
          MOD: &bm "datum - val * (struct.meta and struct.meta.cycl and struct.meta.cycl.period or struct.meta.step and struct.meta.step.amp or 1)"
        META:
          STEP:
            AMP: 1
    - STRUCT:
        BODY:
          MOD: *bm
        META:
          STEP:
            AMP: 1
  STOP: [BEFORE1]

BEFORE1:
  WHEN:
    - STRUCT:
        DATUM:
          lunar: N/A
        BODY:
          MOD: "'#before' and val"
  THEN:
    - STRUCT:
        BODY:
          MOD: *bm
        META:
          STEP:
            AMP: 1

AFTER2:
  WHEN:
    - STRUCT:
        DATUM:
          lunar: N/A
    - STRUCT:
        DATUM:
          lunar: N/A
        BODY:
          MOD: "'#after' and val"
  THEN:
    - STRUCT:
        BODY:
          MOD: &am "datum + val * (struct.meta and struct.meta.cycl and struct.meta.cycl.period or struct.meta.step and struct.meta.step.amp or 1)"
        META:
          STEP:
            AMP: 1
    - STRUCT:
        BODY:
          MOD: *am
        META:
          STEP:
            AMP: 1
  STOP: [AFTER1]

AFTER1:
  WHEN:
    - STRUCT:
        DATUM:
          lunar: N/A
        BODY:
          MOD: "'#after' and val"
  THEN:
    - STRUCT:
        BODY:
          MOD: *am
        META:
          STEP:
            AMP: 1
